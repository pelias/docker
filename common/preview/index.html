<html>
<head>
  <title>pelias autocomplete demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map{ height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script type="module" src="/bundle.js"></script>
  <script>
    var map = L.map('map', {
      center:[42.35, -71.08],
      zoom: 3,
      minZoom:2,
      scrollWheelZoom: false
    });
    L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_toner/{z}/{x}/{y}.png', {
      attribution: 'Tiles by <a href="http://stamen.com">Stamen Design</a>',
      maxZoom: 17,
      minZoom: 1
    }).addTo(map);

    L.Control.searchbar = L.Control.extend({
      onAdd: function (map) {
        let container = L.DomUtil.create('div');
        //For some reasons you need to insert a syntacially correct api_key. Otherwise it won't work and throws weird error messages about missing functions
        container.innerHTML = `<div class="box">
    <ge-autocomplete api_key='ge-0000000000000000'></ge-autocomplete>
    <pre id="result"></pre>
  </div>`
        return container;
      },
      onRemove: function (map) { }
    });
    L.control.searchbar = function (opts) {
      return new L.Control.searchbar(opts);
    };
    L.control.searchbar({ position: 'topleft' }).addTo(map);


    const el = document.querySelector('ge-autocomplete')

    el.addEventListener('change', ({ detail, currentTarget }) => {
      console.log('change', currentTarget)
      console.log(detail)
    })

    el.addEventListener('features', ({ detail, currentTarget }) => {
      console.log('features', currentTarget)
      console.log(detail)
    })

    el.addEventListener('select', ({ detail, currentTarget }) => {
      console.log('select', currentTarget)
      console.log(detail)
      map.setView([detail.geometry.coordinates[1], detail.geometry.coordinates[0]], 14);

    })

    el.addEventListener('error', ({ detail, currentTarget }) => {
      console.log('error', currentTarget)
      console.error(detail)
    });
  </script>
  </body>
</html>